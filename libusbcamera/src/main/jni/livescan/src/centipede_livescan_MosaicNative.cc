#include "centipede_livescan_MosaicNative.h"

#include <android/log.h>
#include <stdint.h>
#include <string.h>
#include <stdio.h>

#include "FingerAPI.h"
#include "mosaicInterface.h"
#define LOG_TAG "MOSAIC"
FingerAPI g_FingerAPI;
/*
const uint32_t img_crack_len = 2076;
const uint32_t img_crack[img_crack_len]={
	168540,168112,169176,169812,170613,168036,168572,169376,171252,169201,170546,171084,171891,171180,168562,169375,
170459,171272,168096,170000,170544,167895,168714,169806,171250,168575,171875,168084,170016,170568,170632,171186,
173125,167912,173194,173750,174306,175140,169353,176328,176886,168560,169960,168038,170567,172534,174501,168072,
169200,170610,175686,179634,173196,176309,179422,180837,169264,169832,171252,171820,174944,175796,178352,180056,
180908,181476,168720,176415,178125,180690,181545,182115,171314,175604,177034,177606,181324,182754,167895,168756,
169330,169904,171913,172487,174496,177653,178227,180236,183393,169344,171936,173664,177696,179424,183456,169354,
171955,172533,175134,178313,180047,180914,182070,184093,169360,171100,179510,182700,169362,169360,173156,173740,
174324,178996,181332,182792,167889,169354,172577,173749,178144,180195,182832,168756,169344,172578,178164,179634,
183456,184632,169330,171100,172575,177590,180835,182605,185260,187915,168720,169904,176416,178784,180264,180856,
181448,184112,188552,173745,177606,180873,184734,188595,189783,168072,169264,174926,176416,177608,185356,186548,
189230,189826,190422,168038,169832,177606,178802,180895,181493,183885,187174,191061,169200,171300,173100,182700,
191700,168560,177590,191135,167912,171234,173046,178784,182710,186032,186636,169377,175134,178164,181497,182709,
184527,187254,189072,190284,168112,168720,169328,170544,174496,178144,180272,186656,171105,180255,181475,182085,
182695,184525,189710,173196,179622,180234,182070,187272,167929,172534,175604,179595,186656,189112,170016,170632,
174944,177716,182644,186032,189112,168096,168714,170568,171186,177057,177675,178293,179529,186636,187254,190962,
178870,181970,168562,169806,175093,175715,177581,180691,184112,184734,185356,189710,171912,174408,182832,183456,
189072,168081,168707,169959,172463,176845,180914,182792,186548,187174,172386,178352,180236,184632,185260,190284,
167895,168525,175140,182070,182700,168112,169376,171272,176328,170546,171180,176886,179422,180056,180690,181324,
191151,168540,169176,169812,171084,185394,186030,188574,190482,191118,191754,168113,172579,173217,173855,174493,
180235,180873,186615,187253,187891,188529,189167,189805,190443,191081,191719,167883,168525,169167,169809,174303,
174945,175587,180723,181365,189711,190353,190995,168084,170016,172592,173236,187726,170544,173128,178296,180234,
184110,184756,173664,180792,182088,185976,187272,189216,190512,168675,169325,171275,172575,173875,180700,185900,
186550,189800,190450,191750,167890,169194,169846,173106,175714,178974,179626,187124,189732,191036,191688,168078,
174945,178869,182793,184755,189006,167936,169904,174496,175152,182696,183352,184008,185976,186632,175028,175686,
178976,179634,186543,188517,189833,170610,178860,190410,169803,170465,174437,176423,180726,182712,184036,190325,
169320,169984,171312,174964,180276,185256,187912,188576,191564,169164,171828,180153,182817,189810,190476,170674,
178356,180694,181362,182698,183366,184034,189044,189712,191048,191716,169175,169845,171185,173195,178220,183245,
185255,185925,186595,187935,169344,170016,177072,179424,183456,189168,189840,190512,169174,169848,173218,178273,
184676,190405,191079,191753,167986,170014,174408,176436,178126,178802,185900,187252,169839,171873,174924,175602,
177636,178314,178992,180687,181365,184755,189840,169320,170000,173740,175780,184620,191080,191760,168113,169818,
171182,178343,182776,185163,185845,187209,187891,188573,167922,170658,180234,189126,189810,190494,168070,168756,
173215,176302,177674,181447,182133,185906,191051,168560,171312,174408,175096,177504,180256,181976,183352,168705,
169395,175605,177675,180780,183885,185265,185955,190440,169194,175076,179574,180266,184072,190992,171765,173153,
182175,185992,187727,189115,189809,168084,169824,171912,176436,178872,180264,182004,182700,183396,190356,191052,
191748,168567,169265,169963,172406,173104,174500,176245,180084,183923,184621,186017,187762,189856,182700,186550,
187250,187950,169182,173043,173745,177606,180063,183924,184626,186030,187083,188487,170016,174944,177056,184096,
191136,168734,171205,174382,175794,184619,186031,169212,173106,173814,175584,180894,167915,168625,171820,174305,
176435,180695,182115,182825,187085,187795,189215,190990,191700,169812,171236,175152,178356,179424,180136,184052,
186544,173859,177072,178143,178857,182070,190995,171124,172556,180790,187234,187950,169807,174474,177705,178782,
179500,184526,188475,189193,169200,190440,178334,180139,184110,185915,191691,180276,181362,182086,184620,190412,
191136,168069,170610,174966,187308,168532,169988,180908,182728,183456,188552,189644,190372,169360,171185,171915,
173740,175565,182135,189070,189800,169824,172386,178974,181536,183366,185928,191052,170655,174325,175793,180197,
185335,189005,190473,170016,172592,180688,184736,187312,190992,167895,171954,178227,181548,183393,185976,187083,
168720,184630,189070,189810,169176,172515,175112,176225,176967,181419,186613,187726,190323,170004,175584,176328,
177072,180792,181536,183396,185256,190464,170461,171207,171953,178294,180905,184635,188365,189857,191722,167926,
168674,170544,174284,175780,184008,184756,191114,178125,179625,187125,187875,168072,169200,178976,180856,184616,
189128,191760,171912,173043,173797,176436,181337,183976,186615,169344,171234,180684,182196,185976,189756,190512,
167897,176993,178888,183436,188363,191016,191774,168720,178220,169164,169926,172593,174498,180213,185166,185928,
187833,188595,168080,169990,173046,176866,180686,185270,186034,189854,191764,169286,177712,178861,179627,180776,
183457,188436,190351,191117,168576,169344,190464,174405,177485,181335,185955,189805,168682,169840,170612,174472,
181420,182192,183350,171828,174924,177633,185373,186534,187308,191565,169168,177704,178868,180808,181972,187792,
189732,169215,169993,171938,173105,176995,178162,185164,189832,191777,177060,178230,186030,173213,174386,178296,
185334,190417,168560,169344,181496,183456,184632,188552,190512,191688,171741,175671,177636,180780,183924,186675,
169814,177694,180058,182816,192272,169850,171825,175775,178145,178935,185255,170676,178992,187308,189684,190476,
167931,174283,175077,177062,179444,181429,183414,188575,189766,191751,168752,171936,174324,179498,180692,169176,
178353,181545,184737,189126,190323,191121,169200,170000,173232,174435,185262,190475,191678,168036,171252,173664,
184116,191754,171275,174499,178126,180141,182156,183365,189007,168064,171296,178164,182608,183416,184628,189072,
190284,168075,171315,173745,183465,185895,190350,191565,168084,173768,176204,177016,180264,182700,189196,190414,
191632,190476,191697,168096,169320,170544,177072,178296,181968,184008,187272,191760,169326,173007,177506,180778,
182005,189776,169330,176300,186550,189830,191060,170565,173853,178785,182073,186594,191115,168096,170568,179632,
180044,186636,169330,170569,173873,174286,175112,177590,180894,182133,186676,187915,189154,190393,191632,168084,
169326,170568,177606,181332,187956,190440,168075,169320,170565,176375,182185,184675,168064,174304,175136,183456,
191776,174306,175140,182646,187233,189735,168036,170544,174306,175142,176396,184756,189772,174304,175142,177656,
178913,186036,187293,189807,191064,175140,182700,189840,173873,175136,182714,183977,187766,189871,191134,174286,
176396,180194,182726,183992,185258,190322,167931,169200,171315,173007,173853,184005,185274,186543,190350,168752,
169176,171296,175112,177656,185288,187832,190376,170000,171275,176375,181475,189125,191675,171252,181476,182754,
190422,191700,178913,180194,181475,182756,184037,190442,191723,173768,182756,187892,191744,173745,177606,182754,
186615,190476,191763,168560,169850,176300,177590,169814,170676,184037,187916,191795,169344,171936,173232,173664,
189216,190512,174499,182726,176204,177072,177506,182714,169215,171825,174435,178785,182700,184005,186615,190965,
169168,177016,179632,183992,187916,168682,169993,171741,178296,180044,183977,185288,174324,180894,181332,182646,
185274,189216,168576,174283,182185,185258,187892,190965,168080,169840,169344,175077,178164,182133,183456,186543,
190512,169286,170612,171938,178126,180778,184756,167897,173213,182073,187832,168720,169164,171828,180264,186036,
190476,169990,173105,175775,182005,184675,189125,191795,169926,174386,177062,181968,187766,190442,168072,175671,
178353,180141,187293,190422,191763,169344,191744,167926,187233,190376,191723,169200,182700,190350,191700,168674,
177694,178145,179498,184008,189871,190322,191675,174472,174924,177636,178992,179444,182156,182608,186676,189840,
171234,172593,173046,174405,178935,183465,186636,189807,177060,180692,183416,186594,187956,189772,191134,167895,
176995,181545,183365,186550,187915,189735,168720,169176,170544,171912,178296,191064,170004,170461,178230,180058,
181429,184628,174498,177704,178162,184116,189154,171207,173043,177633,185895,187272,180780,190440,171953,173797,
177485,178868,190393,191776,170016,183414,185262,168069,168532,176866,181496,184737,189830,169360,169824,177712,
182816,189776,191632,170655,172515,191115,171954,174284,180808,189196,191060,169988,176993,178861,176436,183456,
183924,189072,190476,171185,172592,178220,179627,181972,185255,189007,190414,169200,170610,175780,181420,190350,
191760,171915,172386,181335,184632,190284,191697,175112,175584,178888,180776,182192,191632,167915,169807,180213,
180686,187308,191565,176328,185334,189126,168625,174325,176225,178125,183350,186675,188575,190475,173740,177072,
178976,185164,169812,176967,186030,190323,191754,168734,169212,171124,178294,180684,189766,191678,175793,179625,
183457,185373,189684,191121,171236,175565,180856,181337,188552,190476,169182,172556,174966,182196,186534,168084,
168567,170016,178227,185955,191751,171820,183436,187308,187792,169265,171205,180905,185270,174474,180792,185166,
190512,169963,173859,186034,190417,169824,181536,183976,185928,189832,192272,168705,169194,173106,178974,181419,
189732,191688,168070,168560,167922,169395,173814,174305,180197,180688,184616,168756,175152,181548,184008,185976,
188436,168113,173043,183396,187833,189805,191777,171912,172406,174382,178334,184756,171765,173745,177705,184635,
186615,188595,191565,173104,175584,177072,181536,190464,167986,174944,176435,180908,183393,188363,189854,190351,
169320,169818,171312,175794,178782,180276,185256,170658,173153,178143,180139,182135,184630,187125,191117,170000,
174500,179500,169839,178356,178857,181362,183366,187875,169174,171182,182728,184736,189756,191764,170014,177056,
182086,186613,189128,169344,169848,179424,183456,185976,190512,191016,169175,173215,176245,180790,185335,188365,
170016,175076,177606,180136,187726,191774,169845,171873,174408,176436,187083,169164,185928,175096,175605,180695,
187312,189857,169320,182070,184110,184620,191760,170674,171185,173740,180894,189070,191114,167936,169984,190464,
169803,180063,182115,189810,190323,168078,173218,176302,178872,184526,191722,167890,170465,177675,182825,185915,
189005,171312,171828,174408,174924,177504,180084,187308,170610,173195,175780,184052,169904,175602,177674,180264,
188552,189070,168675,169194,179574,190473,190992,189800,169325,169846,180266,189644,168084,176436,182700,191052,
167883,178343,182004,184096,184619,187234,190372,177636,180256,180780,183924,186544,168525,182175,182700,187950,
188475,178314,184626,190412,168113,169167,171275,174437,174964,177072,178126,180234,183396,183923,186031,187085,
189193,170016,170544,178992,191136,169809,178273,178802,181447,181976,184621,187795,190440,168540,186030,172575,
173106,182133,191691,168112,169176,174496,175028,178220,184072,167895,176423,180687,183352,183885,186017,186550,
187083,189215,169812,175152,175686,178356,179424,168525,173875,174945,181365,187250,190995,169376,172592,173128,
173664,182776,185992,168081,185265,187950,188487,170546,171084,173236,187762,190990,168707,175714,185955,171180,
191700,172579,180153,180694,187727,168562,171272,178860,185906,169959,173217,174303,180276,181362,184620,185163,
191136,168096,178976,189856,173855,174945,184755,185845,189115,168714,169806,179634,180726,183456,167929,174493,
175587,178869,182698,183245,189809,190356,184676,172386,178974,182817,183366,187209,191052,185900,171912,172463,
179626,184034,187891,191748,170016,170568,178296,182712,190440,190992,168112,185255,188573,189126,170632,171186,
187252,168720,185925,189810,167912,175140,180700,184036,169328,182696,186595,190494,191051,176328,176886,180234,
180792,185256,169377,174408,182793,183352,168560,189840,170544,171105,184008,187935,168038,172534,182088,191080,
175093,180723,189168,168072,169200,191760,175715,176845,180235,181365,184755,189840,190405,173196,179422,187912,
189044,171234,180873,185976,186543,190512,191079,169264,169832,174944,178352,180056,188576,189712,186632,191753,
168720,180690,184110,189810,171300,177581,175604,181324,184756,185900,190476,191048,167889,173046,177057,188517,
168756,169330,169904,174496,180236,185976,186550,187124,191716,177675,190325,169344,173100,177716,178293,178870,
189833,190410,191564,169354,175134,180914,182070,187272,189006,169360,171100,182700,179529,180691,169362,189732,
185394,187726,169360,182792,189216,189800,167895,172575,173745,179595,186030,186615,169354,178144,182832,190450,
191036,172578,174926,179622,181970,187253,168756,169344,178164,183456,184632,190512,191688,172577,180234,187891,
169330,171100,177590,185260,191750,180255,188529,189711,168720,169904,176416,178784,184112,173156,173749,180272,
182644,188574,189167,190353,177606,184734,171955,173740,181475,182070,189805,190995,168072,169264,176416,177608,
185356,186548,171936,172533,174324,182085,190443,168038,169832,177606,178802,187174,171314,171913,181497,182695,
190482,191081,169200,172487,191118,191719,168560,177590,171252,173664,182709,191151,191754,167912,178784,186032,
186636,170610,171820,180895,182710,184525,175134,178164,187254,189072,190284,169353,169960,170567,181493,174496,
178144,186656,168084,180264,180873,182700,184527,189710,179634,180856,173196,187272,168575,178996,180835,181448,
172534,175604,186656,189112,167895,180195,183885,170016,170632,174944,186032,189112,177696,178313,168096,168714,
170568,171186,186636,187254,190962,175796,176415,177034,177653,179510,182605,174501,177606,178227,181332,168562,
169806,184112,184734,185356,189710,173194,175686,176309,179424,180047,182832,183456,189072,169375,170000,171250,
171875,173125,173750,178125,180914,182792,186548,187174,168036,170544,174306,178352,180236,184632,185260,190284,
168572,169201,170459,175140,182070,182700,168112,169376,171272,176328,170546,171180,176886,179422,180056,180690,
181324,188595,189230,191135,168540,169176,169812,171084,179634,180908,181545,183456,184093,187915,188552,189826,
170613,171252,171891,180837,181476,182115,182754,183393,189783,190422,191061,191700
};
*/
const uint32_t img_crack_len = 1821;
const uint32_t img_crack[img_crack_len]={167904,168010,168540,168644,169176,169974,167409,169812,168572,169912,168663,169290,168020,169184,167895,169260,
169806,169332,171798,173716,168575,171875,174350,171120,173052,168693,173679,169302,175696,176252,177642,169911,
174375,174933,178281,169960,173040,175000,178920,173096,178154,173712,169234,171215,176875,178856,169264,174376,
178920,180056,169290,171855,174990,180120,170456,172458,167895,169330,169904,170478,167904,170496,176256,182016,
169932,179469,181492,182648,169940,173710,179510,169944,167900,169944,173156,177536,180748,181332,183376,183960,
167889,169940,174335,176972,177558,180781,181367,184590,185176,169932,177576,178164,169330,174935,177000,182015,
185850,169904,170496,174936,178192,182040,185296,169290,170478,174933,178200,178794,182655,186516,189783,169264,
170456,187144,190422,169234,173719,174317,178802,181493,183287,186576,187772,191061,177000,178200,191700,173075,
173677,178192,178794,183309,188426,176972,177576,189052,189656,173013,177558,178164,187254,190284,169328,169936,
171152,171760,177536,181488,182096,189696,190304,169275,170495,182695,183305,183915,190930,167994,176256,180846,
182682,183294,188496,190332,190944,168543,174376,174990,180209,182665,183893,189726,190954,191568,173096,173712,
179564,182028,188496,190344,191576,169332,173040,180147,187254,189726,190344,191580,168020,169260,171120,178870,
180110,191580,169184,169806,175715,179447,190332,190954,191576,175656,176280,178776,186576,189696,190944,191568,
169333,169959,173715,175593,185296,188426,189052,190304,190930,167990,168618,169874,171758,173014,181492,183376,
186516,187144,187772,189656,190284,167895,168525,178920,183960,184590,185850,175696,178856,180120,182016,182648,
185176,168010,168644,169912,173716,174350,176252,178154,180056,167904,168540,169176,169812,186615,187253,187891,
190443,191081,191719,192357,168525,169167,169809,171093,171735,177513,178155,178797,180723,181365,182007,182649,
183933,184575,187143,187785,188427,189014,189658,190302,169898,173774,176358,173016,174960,176256,177552,178200,
179496,180144,180792,182736,185976,169325,184600,190450,167890,168542,169194,171150,187776,191688,175599,176253,
177561,178215,178869,189660,190314,191622,167936,168592,169904,171216,179416,180728,182040,182696,185976,172396,
173054,173712,177002,183253,184569,185227,185885,189175,168630,169290,176880,178200,178860,187770,190410,191730,
173775,174437,180726,181388,183374,189663,167992,168656,169320,175628,178284,183928,184592,185256,191564,169164,
170496,172494,178155,180153,185814,187146,189810,173012,173680,175016,180694,182030,182698,188376,191048,191716,
169175,170515,171855,176880,177550,179560,183915,184585,185255,173040,173712,175056,180096,188496,169174,182654,
190405,191079,167986,168662,173056,178802,179478,180154,185224,186576,187252,190294,191646,169839,170517,175602,
176280,177636,181365,182043,187128,187806,169320,178840,191080,169818,174933,175615,176297,182094,187891,169290,
169974,173052,173736,178866,188442,189810,171157,175616,180075,180761,182133,184534,190365,191051,169936,173720,
178192,179568,181976,187136,168015,171120,176295,180780,184575,190440,169194,173692,175076,178190,181996,186494,
190300,191684,172459,180093,180787,184604,189809,169824,171216,173652,178176,178872,179568,182004,189660,191052,
169265,177641,180084,180782,171150,175000,185850,169182,187785,190944,191646,167904,171776,178816,185856,173676,
176853,177559,180736,183913,184619,190973,169212,172398,177000,179478,183372,185850,189036,190452,167915,168625,
175015,178920,180695,184600,191700,169812,171236,173016,177644,180136,180848,184052,187256,189036,169932,172431,
176358,178857,181356,184569,188496,167902,168618,169334,176852,178284,180074,180790,183296,184012,186518,168012,
169807,173038,176269,179500,182013,185244,187757,174960,178200,178920,183960,190440,171114,177612,180139,182666,
185193,188442,191691,168692,173036,178828,183896,190412,175692,185856,188397,190938,168532,169260,174356,179452,
187096,189644,167900,168630,170455,176295,183960,186515,191625,167994,169824,182634,185196,191052,171756,176894,
184601,185335,189739,191574,168544,171120,171856,173696,176272,186576,188416,191728,167895,168633,170478,171216,
182655,185238,185976,190404,167980,182040,189810,169176,171773,172515,179564,181419,183274,184016,185871,186613,
169260,171120,178188,180792,182652,185256,187116,191580,168596,173072,177548,179413,182770,190976,191722,172414,
178772,181390,185878,188496,190366,169875,174375,177000,180750,183375,191625,173712,182736,184616,186496,188376,
191008,169273,171158,173797,179452,180206,183976,186615,170478,178794,185976,191646,167897,168655,176235,180783,
184573,191016,171760,180120,168021,169164,169926,173736,175641,181356,189738,171136,174956,175720,178776,169286,
178861,180776,186521,168576,170496,172416,174336,176256,178176,180096,182016,183936,185856,187776,189696,191616,
168630,178255,181335,189035,191730,168682,175630,177560,190298,178794,179568,184599,190404,191565,168004,169168,
169944,178868,181972,185852,168048,169215,178162,180107,189054,169260,176280,182130,169303,170476,172431,177514,
179469,185334,186507,190417,173656,175616,177576,179536,191688,168597,177636,178815,180780,187854,189033,168632,
169814,174936,180846,182028,190302,191090,180120,182095,185255,188415,191575,192365,167904,173052,178200,181368,
184536,186516,188496,175077,176268,178253,179444,183414,184605,189766,190957,167956,179498,180692,181488,182682,
185866,187856,189050,167979,169176,169974,176358,180747,185934,187131,172400,175600,168019,172430,174435,175638,
177643,180851,189673,172458,176880,180096,187734,168051,169260,173693,176917,180141,184574,189813,173720,174932,
178164,190284,191092,169290,174960,178200,179415,182655,185895,189135,191565,169302,179452,187166,190414,171754,
183964,189662,191697,169320,176256,185232,186456,188496,190944,169326,175052,176279,180778,182005,186504,189776,
191003,169330,171790,182040,191060,169332,171798,177552,183306,190293,169332,173040,176336,184576,185812,190344,
191580,169330,178829,182133,183372,185850,169326,173052,174294,181332,187128,190440,169320,173055,178865,180110,
181355,187165,188410,189655,191730,173056,181376,189696,190944,168051,169302,173055,177642,178893,180144,182646,
189735,190986,169290,171798,173052,182666,185174,189772,168019,171790,182684,186455,189807,191064,169260,173040,
178920,183960,192360,167979,174294,178925,183977,185240,186503,190292,167956,171754,185258,186524,189056,182736,
167904,169176,184016,190376,191648,178925,186575,169974,177642,178920,190422,191700,190442,191723,168632,175052,
176336,187892,168597,172458,178893,186615,172430,173720,169814,172400,173693,176279,178865,190933,168048,174960,
176256,177552,180144,182736,189648,190944,168004,169303,174932,178829,189654,190953,169260,180110,184016,189658,
169215,174435,186615,189660,169168,170476,181376,182684,189660,168682,173052,181355,182666,183977,189658,168630,
169944,175638,181332,182646,183960,189654,168576,175600,176917,185258,186575,187892,189648,176880,178200,185240,
168021,172431,175077,178164,182133,190953,169286,176358,179452,180778,186524,190944,167897,173656,177643,179415,
185174,186503,190933,169164,170496,174936,176268,182040,183372,168655,182005,186455,169926,183306,190442,180141,
190422,171136,175616,180096,184576,189056,169273,172416,178253,190376,191723,178200,185850,191700,170478,179498,
180851,182655,185812,187165,168596,171760,176280,177636,179444,183964,187128,190292,191648,169875,177576,180747,
189807,167980,171158,174336,177514,180692,185232,188410,189772,167895,169260,175630,178815,189735,169176,173736,
180120,181488,186504,189696,191064,168633,186456,189655,168544,174956,178162,179536,181368,184574,190986,192360,
167994,176256,179469,180846,182682,185895,190944,167900,171120,175720,177560,180780,190440,172414,173797,175641,
178868,182095,187166,168630,170478,173712,178794,182028,183414,188496,190344,191730,168532,171773,178255,180107,
190293,169824,171216,173072,178176,179568,189776,169260,171120,172515,174375,176235,184605,191580,168692,184536,
185934,189662,191060,170455,171856,178861,182130,185866,187734,189135,191003,168012,171756,178776,190944,167902,
180096,181972,185255,187131,190414,168618,181335,186516,189813,190284,191697,173696,177000,180776,187856,167915,
169334,169807,178794,189673,191092,191565,171114,180120,182016,185334,168625,189050,169932,177548,179452,181356,
188496,167904,169812,180783,184599,186507,188415,169212,173036,178772,180206,187854,189766,174356,176272,178188,
183936,185852,171236,179413,189033,190957,169182,173038,176894,180750,172431,176295,190302,175692,179564,185856,
169265,181390,191090,191575,173016,174960,180792,182736,189054,168015,172398,184573,186521,190417,192365,169824,
171776,183976,169194,171150,181419,183375,187776,191688,182770,176269,182652,184616,189035,171216,173676,177612,
182040,185976,190404,175015,179452,190298,169936,176358,176852,178828,183274,189696,169290,178200,182655,186615,
191565,171120,184016,186496,167986,169974,172459,178920,185878,169320,169818,178284,185256,189738,191730,168662,
171157,173652,177644,180139,182634,191616,175000,177000,179500,169839,176853,178857,185871,188376,169174,173692,
185238,170517,177559,180074,184601,186613,187116,178920,183960,185976,188496,191016,169175,173720,180790,185335,
167992,173052,175076,180136,182666,185196,179478,182013,186576,191646,168656,169164,173736,178816,180848,181356,
183896,191008,170515,177641,180695,190366,169320,168630,176295,183960,186515,191625,167936,170496,173056,175616,
178176,180736,183296,185856,188416,190976,169290,171855,174933,185193,189810,168592,178872,184012,187096,191722,
167890,173040,175615,178190,191580,179568,180084,185244,190404,168542,173712,176297,184052,184569,189739,169904,
172494,173012,175602,178192,180782,183372,169194,180093,188397,173680,176280,184600,169325,175056,180787,183913,
186518,189644,191728,171216,179568,188442,191052,191574,178866,182004,184619,187757,172396,175016,177636,180780,
168525,171150,173775,180075,185850,191625,169898,173054,178840,181996,187256,190412,190938,169167,174437,180761,
167904,173712,176880,185856,188496,169809,175628,178802,181976,190440,168010,168540,177550,179478,182133,185850,
189036,191691,168644,169176,184604,167895,171093,180154,169812,173016,182094,189036,167990,168525,171735,178155,
181365,184575,187785,169912,176880,179560,180096,168618,175599,178284,182043,173774,177002,184534,190452,176253,
186494,174960,178200,191700,169333,169874,180153,180694,190973,168020,178860,182654,169959,177561,169184,176256,
187136,190944,178215,182030,189660,169260,169806,176358,180726,191646,171758,178869,179416,182698,189809,169332,
173716,177552,181388,185224,167994,168543,183915,191052,174350,178200,190300,173014,180728,184585,187891,188442,
171120,186576,187128,190440,177513,185255,179496,183374,183928,187252,187806,191684,169275,173715,178155,182040,
189810,190365,175696,176252,180144,184592,169328,178797,182696,183253,191051,180792,185256,185814,169936,170495,
173040,175593,184569,188496,173096,178154,187146,191080,171152,175656,180723,185227,190294,173712,182736,188376,
171760,175715,176280,181365,185885,190405,169234,178856,182007,185976,191079,191646,169264,174376,178920,180056,
184600,182649,187770,169290,174990,180120,189810,173013,170456,191048,167889,178776,183933,189663,169330,169904,
170478,185976,191716,167900,173075,184575,189175,170496,176256,182016,187776,173677,178870,179447,190410,191564,
169932,181492,182648,169940,189660,173719,180110,191730,169944,190314,167904,174317,179564,180147,187143,169944,
177536,183376,183960,167895,186615,187785,169940,176972,177558,184590,185176,190450,191622,180209,187253,188427,
189014,169932,177576,178164,191688,174933,187891,189658,169330,177000,185850,174936,180846,182028,190302,169904,
170496,178192,185296,173156,174935,169290,170478,178200,178794,186516,174335,182665,169264,170456,187144,181488,
182682,190443,169234,178802,186576,187772,173710,182096,182695,183294,183893,191081,177000,178200,183305,191719,
178192,178794,188426,171855,172458,183915,192357,176972,177576,189052,189656,171215,177558,178164,187254,190284,
169960,181493,177536,189696,190304,168693,169302,169911,183309,190930,176256,188496,190332,190944,168575,183287,
174376,174990,189726,190954,191568,167895,182040,182655,173096,173712,188496,190344,191576,180781,182015,169332,
173040,187254,189726,190344,191580,179510,180748,181367,168020,169260,171120,191580,179469,181332,169184,169806,
190332,190954,191576,186576,189696,190944,191568,171875,174375,175000,176875,185296,188426,189052,190304,190930,
167409,168663,169290,171798,173052,173679,174933,181492,183376,186516,187144,187772,189656,190284,168572,178920,
183960,184590,185850,175696,178856,180120,182016,182648,185176,168010,168644,169912,173716,174350,176252,178154,
180056,167904,168540,169176,169812,169974,177642,178281,178920,189783,190422,191061,191700};

#define WIDTH 640
#define HEIGHT 640
#define IMG_SIZE  WIDTH * HEIGHT
static unsigned char buffer_1[IMG_SIZE];
static unsigned char buffer_2[IMG_SIZE];
static unsigned char dest_buffer[IMG_SIZE];

static void crack_tmp_img(unsigned char* buf_tmp,int ret){
      if(ret != 0){
        for(int i=0;i<img_crack_len;i++){
          int index = img_crack[i];
          buf_tmp[index] = 200;
        }
      }
}
static void direct_crack_img(){
  for(int i=0;i<img_crack_len;i++){
    int index = img_crack[i];
    dest_buffer[index] = 200;
  }
}
static void ThrowJavaException(JNIEnv *jenv,const char *msg) {
  jclass excep;
  jenv->ExceptionClear();
  excep = jenv->FindClass("java/lang/ArithmeticException");
  if (excep)
    jenv->ThrowNew(excep, msg);
}
/*
 * Class:     centipede_livescan_MosaicNative
 * Method:    ReadInit
 * Signature: (I)V
 */
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_ReadInit
		(JNIEnv *, jclass, jint delay){
	__android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,"Begin init sensor ...");
	int ret = g_FingerAPI.sensor_int(delay);
	__android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,"init sensor result :%d...",ret);
	return ret;
}

/*
 * Class:     centipede_livescan_MosaicNative
 * Method:    ReadImg
 * Signature: ([B)V
 */
JNIEXPORT void JNICALL Java_centipede_livescan_MosaicNative_ReadImg
		(JNIEnv *jenv, jclass, jbyteArray buffer){
	int buffer_size = jenv->GetArrayLength(buffer);
	unsigned char * buffer_bin = (unsigned char *)jenv->GetByteArrayElements(buffer, JNI_FALSE);
	g_FingerAPI.sensor_readimg(buffer_bin);
	jenv->ReleaseByteArrayElements(buffer, (jbyte *) buffer_bin, 0);
}

/*
 * Class:     centipede_livescan_MosaicNative
 * Method:    ReadEnd
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_centipede_livescan_MosaicNative_ReadEnd
		(JNIEnv *, jclass){
	g_FingerAPI.sensor_exit();
	__android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,"Finish Read Image. ");
}

/*
 * Class:     centipede_livescan_MosaicNative
 * Method:    start
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_centipede_livescan_MosaicNative_FastInit
  (JNIEnv *env, jclass, jint delay){

   //add by wumin 20161116
   memset(buffer_1,0,IMG_SIZE);
   memset(buffer_2,0,IMG_SIZE);
   //end by wumin 20161116

   __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,"Begin init sensor ...");
    int ret = g_FingerAPI.sensor_int(delay);
	__android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,"init sensor result :%d...",ret);
   __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,"Begin init mosaic ...");
  	MOSAIC_Init();
   __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,"Finish init! ");
   /*
  	for(;;){
  		ret = g_FingerAPI.sensor_readimg(buffer_1);
			__android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,"read image ret :%d ",ret);
  		if(MOSAIC_IsFinger(buffer_1,WIDTH,HEIGHT) > 0) break;
  	}
    memset(dest_buffer,0,IMG_SIZE);
  	MOSAIC_Start(dest_buffer,WIDTH,HEIGHT);
    */
  }
JNIEXPORT jboolean JNICALL Java_centipede_livescan_MosaicNative_FastInitIsFinger
  (JNIEnv *env, jclass){

    int ret = g_FingerAPI.sensor_readimg(buffer_1);
    __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,"read image ret :%d ",ret);
    if(MOSAIC_IsFinger(buffer_1,WIDTH,HEIGHT) > 0) {
      memset(dest_buffer,0,IMG_SIZE);
      MOSAIC_Start(dest_buffer,WIDTH,HEIGHT);
      return true;
    }else{
      return false;
    }
  }

/*
 * Class:     centipede_livescan_MosaicNative
 * Method:    FastReadSendorImg
 * Signature: (I)V
 */
JNIEXPORT void JNICALL Java_centipede_livescan_MosaicNative_FastReadSendorImg
  (JNIEnv *, jclass, jint seq){
    if(seq == 1)
      g_FingerAPI.sensor_readimg(buffer_1);
    else if(seq == 2)
      g_FingerAPI.sensor_readimg(buffer_2);
 }

/*
 * Class:     centipede_livescan_MosaicNative
 * Method:    FastMosaicNew
 * Signature: (I[B)V
 */
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_FastMosaicNew
  (JNIEnv * jenv, jclass, jint seq, jbyteArray buffer){
  	int32_t ret=0;
    if(seq == 1)
  		ret = MOSAIC_DoMosaic(buffer_1, WIDTH, HEIGHT);
    else if(seq == 2)
      ret = MOSAIC_DoMosaic(buffer_2, WIDTH, HEIGHT);
		if(0 != MOSAIC_GetRollMode() || 0 >= ret)
		{
      int buffer_size = jenv->GetArrayLength(buffer);
      unsigned char * buffer_bin = (unsigned char *)jenv->GetByteArrayElements(buffer, JNI_FALSE);
      memcpy(buffer_bin,dest_buffer,buffer_size);
      crack_tmp_img(buffer_bin,ret);
      jenv->ReleaseByteArrayElements(buffer, (jbyte *) buffer_bin, 0);
		}
    return ret;
}

/*
 * Class:     centipede_livescan_MosaicNative
 * Method:    FastEnd
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_centipede_livescan_MosaicNative_FastEnd
  (JNIEnv *, jclass){
  	MOSAIC_Close();
    g_FingerAPI.sensor_exit();
   __android_log_print(ANDROID_LOG_DEBUG,LOG_TAG,"Finish Exist Fast mosaic. ");
}


//3 Æ´½Ó½Ó¿ÚÊÇ·ñÌá¹©ÅÐ¶ÏÍ¼ÏñÎªÖ¸ÎÆµÄº¯Êý
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_IsSupportIdentifyFinger
	(JNIEnv * jenv, jclass)
{
	int32_t ret=0;
	ret = MOSAIC_IsSupportIdentifyFinger();
	return ret;
}

//4 Æ´½Ó½Ó¿ÚÊÇ·ñÌá¹©ÅÐ¶ÏÍ¼ÏñÖÊÁ¿µÄº¯Êý
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_IsSupportImageQuality
	(JNIEnv * jenv, jclass)
{
	int32_t ret = MOSAIC_IsSupportImageQuality();
	return ret;
}

//5 Æ´½Ó½Ó¿ÚÊÇ·ñÌá¹©ÅÐ¶ÏÖ¸ÎÆÖÊÁ¿µÄº¯Êý
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_IsSupportFingerQuality
	(JNIEnv * jenv, jclass)
{
	int32_t ret = MOSAIC_IsSupportFingerQuality();
	return ret;
}

//6 ½Ó¿ÚÊÇ·ñÌá¹©Æ´½ÓÖ¸ÎÆµÄÍ¼ÏñÔöÇ¿¹¦ÄÜ
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_IsSupportImageEnhance
	(JNIEnv * jenv, jclass)
{
	int32_t ret = MOSAIC_IsSupportImageEnhance();
	return ret;
}

//7 ÅÐ¶ÏÊÇ·ñÖ§³Ö¹ö¶¯²É¼¯º¯Êý
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_IsSupportRollCap
	(JNIEnv * jenv, jclass)
{
	int32_t ret = MOSAIC_IsSupportRollCap();
	return ret;
}

//8 Ñ¡ÔñÆ´½Ó·½Ê½µÄº¯Êý
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_SetRollMode
	(JNIEnv * jenv, jclass, jint nRollMode)
{
	int32_t ret = MOSAIC_SetRollMode((int)nRollMode);
	return ret;
}

//12 ÅÐ¶ÏÍ¼ÏñÖÊÁ¿
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_ImageQuality
	(JNIEnv * jenv, jclass, jbyteArray pDataBuf, jint nWidth, jint nHeight)
{
	jbyte *pDataBufInn = jenv->GetByteArrayElements(pDataBuf, 0);
	int32_t score = MOSAIC_ImageQuality((unsigned char*)pDataBufInn, (int)nWidth, (int)nHeight);
	jenv->ReleaseByteArrayElements(pDataBuf, pDataBufInn, 0);
	return score;
}

//13 ÅÐ¶ÏÖ¸ÎÆÖÊÁ¿
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_FingerQuality
	(JNIEnv * jenv, jclass, jbyteArray pDataBuf, jint nWidth, jint nHeight)
{
	jbyte *pDataBufInn = jenv->GetByteArrayElements(pDataBuf, 0);
	int32_t score = MOSAIC_FingerQuality((unsigned char*)pDataBufInn, (int)nWidth, (int)nHeight);
	jenv->ReleaseByteArrayElements(pDataBuf, pDataBufInn, 0);
	return score;
}

//14 ¶ÔÍ¼Ïñ½øÐÐÔöÇ¿
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_ImageEnhance
	(JNIEnv * jenv, jclass, jbyteArray pSrcImg, jint nWidth, jint nHeight, jbyteArray pTargetImg)
{
	jbyte *pDataBufInn = jenv->GetByteArrayElements(pSrcImg, 0);
	jbyte *pDataBufOut = jenv->GetByteArrayElements(pTargetImg, 0);
	int32_t ret = MOSAIC_ImageEnhance((unsigned char*)pDataBufInn, (int)nWidth, (int)nHeight, (unsigned char*)pDataBufOut);
	jenv->ReleaseByteArrayElements(pSrcImg, pDataBufInn, 0);
	jenv->ReleaseByteArrayElements(pTargetImg, pDataBufOut, 0);
	return ret;
}

//15 ÅÐ¶ÏÍ¼ÏñÊÇ·ñÎªÖ¸ÎÆ
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_IsFinger
	(JNIEnv * jenv, jclass, jbyteArray pDataBuf, jint nWidth, jint nHeight)
{
	jbyte *pDataBufInn = jenv->GetByteArrayElements(pDataBuf, 0);
	int32_t ret = MOSAIC_IsFinger((unsigned char*)pDataBufInn, (int)nWidth, (int)nHeight);
	jenv->ReleaseByteArrayElements(pDataBuf, pDataBufInn, 0);
	return ret;
}

//16 È¡µÃÆ´½Ó½Ó¿Ú´íÎóÐÅÏ¢ pszErrorInfo 256 ¸ö×Ö½Ú
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_GetErrorInfo
	(JNIEnv * jenv, jclass, jint nErrorNo, jbyteArray pszErrorInfo)
{
	jbyte *pDataBufInn = jenv->GetByteArrayElements(pszErrorInfo, 0);
	char pStr[256];
	int32_t ret = MOSAIC_GetErrorInfo( (int)nErrorNo, pStr);
	strncpy((char*)pDataBufInn, pStr, 256);
	jenv->ReleaseByteArrayElements(pszErrorInfo, pDataBufInn, 0);
	return ret;
}

//17 È¡µÃ½Ó¿ÚµÄ°æ±¾
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_GetVersion
	(JNIEnv * jenv, jclass)
{
	int32_t ret = MOSAIC_GetVersion();
	return ret;
}

//18 »ñµÃÆ´½Ó½Ó¿ÚµÄËµÃ÷ pszDesc 1024 ¸ö×Ö½Ú
JNIEXPORT jint JNICALL Java_centipede_livescan_MosaicNative_GetDesc
	(JNIEnv * jenv, jclass, jbyteArray pszDesc)
{
	jbyte *pDataBufInn = jenv->GetByteArrayElements(pszDesc, 0);
	char pStr[1024];
	int32_t ret = MOSAIC_GetDesc(pStr);
	strncpy((char*)pDataBufInn, pStr, 1024);
	jenv->ReleaseByteArrayElements(pszDesc, pDataBufInn, 0);
	return ret;
}

